
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="./style/grid.css">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/noUiSlider/14.6.4/nouislider.min.js"></script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/noUiSlider/14.6.4/nouislider.min.css" rel="stylesheet"/>

  </head>
  <body>
    <noscript>niivue requires JavaScript.</noscript>
   
    
      Drag and drop or
      <button id="openBtn">upload image</button>
   
      <div id="container">
        test1
        <canvas id="gl1"></canvas>
        test2
    
        <div id="intensity">&nbsp;</div>


        <h2 id="contrastTitle" hidden>Contrast</h2>

        <div id="contrastControls" style="width: 80%; margin: 20px auto;">
          <div id="contrastSlider"></div>
          <div style="display: flex; justify-content: space-between; margin-top: 10px;">
            <label id="minContrast" hidden>Min: <input type="number" id="minInput" step="0.1"></label>
            <label id="maxContrast" hidden>Max: <input type="number" id="maxInput" step="0.1"></label>
          </div>
        </div>
        
        <div >
         
          <div id="contrastSlider"></div>

      </div>
    
      </div>

 

  </body>

  </html>




    <script type="module" async>






     
      import * as niivue from "https://niivue.github.io/niivue/dist/index.js";

      function updateIntensity(data) {
      document.getElementById("intensity").innerHTML = "&nbsp;&nbsp;" + data.string;
    }


//upload image functionality
    async function addVolumeFromFiles(f) {
          console.log('attempting to open ', f[0].name)
          console.log('details', f[0])
            if (nv.volumes.length > 0) {
    nv.removeVolumeByIndex(0);
  }
          nv.loadFromFile(f[0])
      }
    openBtn.onclick = function () {
        let input = document.createElement('input');
        input.style.display = 'none';
        input.type = 'file'
        document.body.appendChild(input);
        input.onchange = function (event) {
          addVolumeFromFiles(event.target.files)
        }
        input.click()
      }
     
      var nv = new niivue.Niivue({onLocationChange: updateIntensity});
      await nv.attachTo("gl1");



      nv.setMultiplanarPadPixels(5);
      nv.setSliceType(nv.sliceTypeMultiplanar);


      

      nv.onImageLoaded = function (volume) {
  console.log("Dropped volume loaded:", volume.name);

  const contrastSlider = document.getElementById("contrastSlider");
  const minCon = document.getElementById("minContrast");
  const maxCon = document.getElementById("maxContrast");
  const minInput = document.getElementById("minInput");
  const maxInput = document.getElementById("maxInput");
  const contrastTitle = document.getElementById("contrastTitle")

  // Show inputs
  contrastTitle.hidden = false;
  minCon.hidden = false;
  maxCon.hidden = false;

  const startMin = volume.cal_min;
  const startMax = volume.cal_max;

  // ðŸ’¥ DESTROY old slider completely
  if (contrastSlider.noUiSlider) {
    contrastSlider.noUiSlider.destroy();
  }

  // ðŸ’¡ Fully recreate slider
  noUiSlider.create(contrastSlider, {
    start: [startMin, startMax],
    connect: true,
    tooltips: true,
    range: {
      min: volume.global_min,
      max: volume.global_max
    }
  });

  //  Reset inputs
  minInput.value = startMin.toFixed(2);
  maxInput.value = startMax.toFixed(2);

  //  Bind slider â†’ inputs + contrast
  contrastSlider.noUiSlider.on('update', (values) => {
    const [min, max] = values.map(parseFloat);
    volume.cal_min = min;
    volume.cal_max = max;
    nv.updateGLVolume();

    minInput.value = min.toFixed(2);
    maxInput.value = max.toFixed(2);
  });

  // ðŸ’¥ Remove old input listeners before adding new ones
 
  // Bind new input â†’ slider
  [minInput, maxInput].forEach((input, i) => {
    input.addEventListener("change", () => {
      const min = parseFloat(minInput.value);
      const max = parseFloat(maxInput.value);
      contrastSlider.noUiSlider.set([min, max]);
    });
  });
};





      
    </script>
  



